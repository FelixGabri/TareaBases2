<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Actualizar Empleado</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            background-color: white;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border: 1px solid #e0e0e0;
        }

        h1 {
            text-align: center;
            margin-bottom: 2rem;
            color: #333;
        }

        .employee-info {
            background-color: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            border: 1px solid #e0e0e0;
        }

        .info-item {
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
        }

        .info-label {
            font-weight: bold;
            color: #555;
        }

        .info-value {
            color: #333;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #333;
            font-weight: bold;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #ff69b4;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            margin: 0.25rem;
        }

        .btn-primary {
            background-color: #ff69b4;
            color: white;
        }

        .btn-primary:hover {
            background-color: #ff1493;
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #545b62;
        }

        .btn-danger {
            background-color: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        .btn-success {
            background-color: #28a745;
            color: white;
        }

        .btn-success:hover {
            background-color: #218838;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #666;
        }

        .error-message {
            background-color: #ffe6e6;
            color: #d63384;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            text-align: center;
        }

        .success-message {
            background-color: #d4edda;
            color: #155724;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            text-align: center;
        }

        .button-group {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 1rem;
            color: #ff69b4;
            text-decoration: none;
            cursor: pointer;
        }

        .back-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function ActualizarEmpleado() {
            const [employee, setEmployee] = useState(null);
            const [formData, setFormData] = useState({
                idPuesto: '',
                valorDocumentoIdentidad: '',
                nombre: ''
            });
            const [loading, setLoading] = useState(true);
            const [updating, setUpdating] = useState(false);
            const [error, setError] = useState('');
            const [success, setSuccess] = useState('');

            useEffect(() => {
                const urlParams = new URLSearchParams(window.location.search);
                const employeeId = urlParams.get('id');

                if (!employeeId) {
                    setError('No se especificó el ID del empleado');
                    setLoading(false);
                    return;
                }

                cargarEmpleado(employeeId);
            }, []);

            const cargarEmpleado = async (employeeId) => {
                try {
                    setLoading(true);
                    const response = await fetch(`http://localhost:3000/api/empleados`);
                    
                    if (response.ok) {
                        const employees = await response.json();
                        const employeeData = employees.find(emp => emp.Id == employeeId);
                        
                        if (employeeData) {
                            setEmployee(employeeData);
                            setFormData({
                                idPuesto: employeeData.IdPuesto ? employeeData.IdPuesto.toString() : '',
                                valorDocumentoIdentidad: employeeData.ValorDocumentoIdentidad || '',
                                nombre: employeeData.Nombre || ''
                            });
                        } else {
                            setError('Empleado no encontrado');
                        }
                    } else {
                        throw new Error('Error al cargar empleados');
                    }
                } catch (error) {
                    console.error('Error cargando empleado:', error);
                    setError('Error al cargar datos del empleado');
                } finally {
                    setLoading(false);
                }
            };

            const handleInputChange = (field, value) => {
                setFormData(prev => ({
                    ...prev,
                    [field]: value
                }));
            };

            const actualizarEmpleado = async () => {
    if (!employee) return;

    setUpdating(true);
    setError('');
    setSuccess('');

    try {
        const response = await fetch(`http://localhost:3000/api/empleados/${employee.Id}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        });

        const result = await response.json();

        if (result.success) {
            setSuccess('✅ Empleado actualizado correctamente');
            
            // Actualizar datos locales
            setEmployee(prev => ({
                ...prev,
                Nombre: formData.nombre,
                ValorDocumentoIdentidad: formData.valorDocumentoIdentidad,
                IdPuesto: parseInt(formData.idPuesto)
            }));
        } else {
            setError(result.message || 'Error al actualizar empleado');
        }
    } catch (error) {
        console.error('Error actualizando empleado:', error);
        setError('Error de conexión con el servidor');
    } finally {
        setUpdating(false);
    }
};

            const eliminarEmpleado = async () => {
    if (!employee || !confirm('¿Estás seguro de que deseas eliminar este empleado?')) {
        return;
    }

    setUpdating(true);
    setError('');
    setSuccess('');

    try {
        const response = await fetch(`http://localhost:3000/api/empleados/${employee.Id}`, {
            method: 'DELETE'
        });

        const result = await response.json();

        if (result.success) {
            setSuccess('✅ Empleado eliminado correctamente');
            
            // Cerrar ventana después de 2 segundos
            setTimeout(() => {
                window.close();
            }, 2000);
        } else {
            setError(result.message || 'Error al eliminar empleado');
        }
    } catch (error) {
        console.error('Error eliminando empleado:', error);
        setError('Error de conexión con el servidor');
    } finally {
        setUpdating(false);
    }
};

            const abrirMovimientos = () => {
                if (employee) {
                    window.open(`movimientos.html?id=${employee.Id}`, '_blank');
                }
            };

            const goBack = () => {
                window.close();
            };

            if (loading) {
                return React.createElement('div', { className: 'container' },
                    React.createElement('div', { className: 'loading' }, 'Cargando datos del empleado...')
                );
            }

            if (!employee) {
                return React.createElement('div', { className: 'container' },
                    React.createElement('h1', null, 'Empleado no encontrado'),
                    React.createElement('button', { 
                        className: 'btn btn-secondary',
                        onClick: goBack
                    }, 'Cerrar')
                );
            }

            return React.createElement('div', { className: 'container' },
                React.createElement('a', { 
                    className: 'back-link',
                    onClick: goBack
                }, '← Cerrar'),
                
                React.createElement('h1', null, 'Actualizar Empleado'),
                
                // Información actual del empleado
                React.createElement('div', { className: 'employee-info' },
                    React.createElement('h3', { style: { marginBottom: '1rem', color: '#333' } }, 'Información Actual'),
                    React.createElement('div', { className: 'info-item' },
                        React.createElement('span', { className: 'info-label' }, 'ID:'),
                        React.createElement('span', { className: 'info-value' }, employee.Id)
                    ),
                    React.createElement('div', { className: 'info-item' },
                        React.createElement('span', { className: 'info-label' }, 'Saldo Vacaciones:'),
                        React.createElement('span', { className: 'info-value' }, `${employee.SaldoVacaciones} días`)
                    )
                ),

                // Mensajes de error/éxito
                error && React.createElement('div', { className: 'error-message' }, error),
                success && React.createElement('div', { className: 'success-message' }, success),

                // Formulario de actualización
                React.createElement('form', { onSubmit: (e) => e.preventDefault() },
                    React.createElement('div', { className: 'form-group' },
                        React.createElement('label', null, 'Puesto:'),
                        React.createElement('select', {
                            value: formData.idPuesto,
                            onChange: (e) => handleInputChange('idPuesto', e.target.value),
                            disabled: updating
                        },
                            React.createElement('option', { value: '' }, 'Seleccionar puesto'),
                            React.createElement('option', { value: '1' }, 'Desarrollador'),
                            React.createElement('option', { value: '2' }, 'Diseñador'),
                            React.createElement('option', { value: '3' }, 'Gerente'),
                            React.createElement('option', { value: '4' }, 'Analista')
                        )
                    ),

                    React.createElement('div', { className: 'form-group' },
                        React.createElement('label', null, 'Cédula:'),
                        React.createElement('input', {
                            type: 'text',
                            value: formData.valorDocumentoIdentidad,
                            onChange: (e) => handleInputChange('valorDocumentoIdentidad', e.target.value),
                            placeholder: 'Ej: 123456789',
                            disabled: updating
                        })
                    ),

                    React.createElement('div', { className: 'form-group' },
                        React.createElement('label', null, 'Nombre Completo:'),
                        React.createElement('input', {
                            type: 'text',
                            value: formData.nombre,
                            onChange: (e) => handleInputChange('nombre', e.target.value),
                            placeholder: 'Ej: Juan Pérez García',
                            disabled: updating
                        })
                    ),

                    // Botones de acción
                    React.createElement('div', { className: 'button-group' },
                        React.createElement('div', { className: 'action-buttons' },
                            React.createElement('button', {
                                className: 'btn btn-primary',
                                onClick: actualizarEmpleado,
                                disabled: updating || !formData.idPuesto || !formData.valorDocumentoIdentidad || !formData.nombre
                            }, updating ? 'Actualizando...' : 'Actualizar Empleado'),
                            
                            React.createElement('button', {
                                className: 'btn btn-success',
                                onClick: abrirMovimientos,
                                disabled: updating
                            }, 'Ver Movimientos')
                        ),
                        
                        React.createElement('button', {
                            className: 'btn btn-danger',
                            onClick: eliminarEmpleado,
                            disabled: updating
                        }, 'Eliminar Empleado')
                    )
                )
            );
        }

        // Renderizar la aplicación
        ReactDOM.render(React.createElement(ActualizarEmpleado), document.getElementById('root'));
    </script>
</body>
</html>